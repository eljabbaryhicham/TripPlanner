{
  "entities": {
    "CarRental": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CarRental",
      "type": "object",
      "description": "Represents a car rental service offering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the car rental service."
        },
        "name": {
          "type": "string",
          "description": "Name of the car rental company or service."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the car rental service."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the car rental service.",
          "format": "uri"
        },
        "pricePerDay": {
          "type": "number",
          "description": "Price per day for renting the car."
        },
        "location": {
          "type": "string",
          "description": "Location where the car rental service is available."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the service is currently active and available for booking."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "pricePerDay",
        "location"
      ]
    },
    "Hotel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hotel",
      "type": "object",
      "description": "Represents a hotel or hostel accommodation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hotel or hostel."
        },
        "name": {
          "type": "string",
          "description": "Name of the hotel or hostel."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the hotel or hostel."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the hotel or hostel.",
          "format": "uri"
        },
        "pricePerNight": {
          "type": "number",
          "description": "Price per night for staying at the hotel or hostel."
        },
        "location": {
          "type": "string",
          "description": "Location of the hotel or hostel."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the service is currently active and available for booking."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "pricePerNight",
        "location"
      ]
    },
    "Transport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transport",
      "type": "object",
      "description": "Represents a transport service offering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transport service."
        },
        "name": {
          "type": "string",
          "description": "Name of the transport service."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the transport service."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the transport service.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price for the transport service."
        },
        "origin": {
          "type": "string",
          "description": "Origin location of the transport service."
        },
        "destination": {
          "type": "string",
          "description": "Destination location of the transport service."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the service is currently active and available for booking."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "origin",
        "destination"
      ]
    },
    "Reservation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reservation",
      "type": "object",
      "description": "Represents a reservation made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reservation."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Reservation)"
        },
        "serviceType": {
          "type": "string",
          "description": "Type of service reserved (e.g., 'CarRental', 'Hotel', 'Transport')."
        },
        "serviceId": {
          "type": "string",
          "description": "ID of the specific service being reserved (e.g., CarRental.id)."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the reservation.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the reservation.",
          "format": "date-time"
        },
        "totalPrice": {
          "type": "number",
          "description": "Total price of the reservation."
        },
        "reservationDate": {
          "type": "string",
          "description": "Date when the reservation was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "serviceType",
        "serviceId",
        "startDate",
        "endDate",
        "totalPrice",
        "reservationDate"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "AdminUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminUser",
      "type": "object",
      "description": "Represents an administrator user for the dashboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin user, corresponds to Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "Email address of the admin user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the admin user.",
          "enum": ["admin", "superadmin"]
        },
        "createdAt": {
          "type": "string",
          "description": "The date the admin was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "createdAt"
      ]
    },
    "ServiceSuggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceSuggestion",
      "type": "object",
      "description": "Represents a service suggestion generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service suggestion."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ServiceSuggestion).  The user that this suggestion is for."
        },
        "serviceType": {
          "type": "string",
          "description": "The type of service being suggested (e.g., 'Hotel', 'Transport', 'CarRental')."
        },
        "serviceId": {
          "type": "string",
          "description": "Reference to the specific service being suggested.  For example, the ID of a hotel in the Hotel entity."
        },
        "suggestionReason": {
          "type": "string",
          "description": "Reason for the suggestion (e.g., 'Past booking history', 'Similar preferences')."
        },
        "suggestionDate": {
          "type": "string",
          "description": "Date when the suggestion was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "serviceType",
        "serviceId",
        "suggestionReason",
        "suggestionDate"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a user review for a service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "userId": {
          "type": "string",
          "description": "ID of the user who wrote the review."
        },
        "serviceId": {
          "type": "string",
          "description": "ID of the service being reviewed."
        },
        "rating": {
          "type": "number",
          "description": "Rating from 1 to 5."
        },
        "comment": {
          "type": "string",
          "description": "The user's review comment."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Date when the review was created."
        },
        "authorName": {
          "type": "string",
          "description": "Display name of the author."
        },
        "authorImage": {
          "type": "string",
          "description": "Profile image URL of the author.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "serviceId",
        "rating",
        "comment",
        "createdAt",
        "authorName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. Path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reservations/{reservationId}",
        "definition": {
          "entityName": "Reservation",
          "schema": {
            "$ref": "#/backend/entities/Reservation"
          },
          "description": "Stores reservations made by a specific user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "reservationId",
              "description": "The unique identifier for the reservation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/serviceSuggestions/{serviceSuggestionId}",
        "definition": {
          "entityName": "ServiceSuggestion",
          "schema": {
            "$ref": "#/backend/entities/ServiceSuggestion"
          },
          "description": "Stores service suggestions for a specific user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "serviceSuggestionId",
              "description": "The unique identifier for the service suggestion."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}",
        "definition": {
          "entityName": "Hotel",
          "schema": {
            "$ref": "#/backend/entities/Hotel"
          },
          "description": "Stores hotel data.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier for the hotel."
            }
          ]
        }
      },
      {
        "path": "/carRentals/{carRentalId}",
        "definition": {
          "entityName": "CarRental",
          "schema": {
            "$ref": "#/backend/entities/CarRental"
          },
          "description": "Stores car rental data.",
          "params": [
            {
              "name": "carRentalId",
              "description": "The unique identifier for the car rental."
            }
          ]
        }
      },
      {
        "path": "/transports/{transportId}",
        "definition": {
          "entityName": "Transport",
          "schema": {
            "$ref": "#/backend/entities/Transport"
          },
          "description": "Stores transport data.",
          "params": [
            {
              "name": "transportId",
              "description": "The unique identifier for the transport service."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{adminId}",
        "definition": {
          "entityName": "AdminUser",
          "schema": {
            "$ref": "#/backend/entities/AdminUser"
          },
          "description": "Collection to store admin user roles and data. Used for role-based access control.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier for the admin user, matching their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores all reviews for all services. Publicly readable.",
          "params": [
            {
              "name": "reviewId",
              "description": "The unique identifier for the review."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. User data is stored under `/users/{userId}` ensuring path-based ownership. Reservations made by each user are stored in a subcollection `/users/{userId}/reservations/{reservationId}`. Service Suggestions are similarly organized under `/users/{userId}/serviceSuggestions/{serviceSuggestionId}`, ensuring the suggestions are linked to the correct user.\n\nThe `hotels`, `carRentals`, and `transports` collections store the data for each of those service types.  Admin users are managed via the `/roles_admin/{adminId}` collection, which now stores a `role` field for fine-grained access control (admin vs. superadmin). A top-level `reviews` collection is added to store user reviews for all services; this allows for easy querying by service and is secured to allow creation only by authenticated users for themselves.\n\nThis structure achieves Authorization Independence by avoiding hierarchical authorization dependencies. All authorization rules rely on `request.auth.uid` and the document paths. Denormalization is not required in this schema because user-owned data is stored in hierarchical paths. This approach ensures proper QAPs, as listing operations are secure based on path-based ownership.\n\nBy using this schema and appropriate security rules, we can prevent filter-based security and ensure that all listing operations are inherently secure."
  }
}
