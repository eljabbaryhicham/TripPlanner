{
  "entities": {
    "CarRental": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CarRental",
      "type": "object",
      "description": "Represents a car rental service offering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the car rental service."
        },
        "name": {
          "type": "string",
          "description": "Name of the car rental company or service."
        },
        "label": {
          "type": "string",
          "description": "An internal label for the service, used for easier identification in the admin dashboard. Not visible to customers."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the car rental service."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the car rental service.",
          "format": "uri"
        },
        "pricePerDay": {
          "type": "number",
          "description": "Price per day for renting the car."
        },
        "location": {
          "type": "string",
          "description": "Location where the car rental service is available."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the service is currently active and available for booking."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "pricePerDay",
        "location"
      ]
    },
    "Hotel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Hotel",
      "type": "object",
      "description": "Represents a hotel or hostel accommodation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the hotel or hostel."
        },
        "name": {
          "type": "string",
          "description": "Name of the hotel or hostel."
        },
        "label": {
          "type": "string",
          "description": "An internal label for the service, used for easier identification in the admin dashboard. Not visible to customers."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the hotel or hostel."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the hotel or hostel.",
          "format": "uri"
        },
        "pricePerNight": {
          "type": "number",
          "description": "Price per night for staying at the hotel or hostel."
        },
        "location": {
          "type": "string",
          "description": "Location of the hotel or hostel."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the service is currently active and available for booking."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "pricePerNight",
        "location"
      ]
    },
    "Transport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transport",
      "type": "object",
      "description": "Represents a transport service offering.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transport service."
        },
        "name": {
          "type": "string",
          "description": "Name of the transport service."
        },
        "label": {
          "type": "string",
          "description": "An internal label for the service, used for easier identification in the admin dashboard. Not visible to customers."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the transport service."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the transport service.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Base price for the transport service."
        },
        "location": {
          "type": "string",
          "description": "General service area, e.g., 'Morocco Wide'."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the service is currently active and available for booking."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "location"
      ]
    },
    "ExploreTrip": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ExploreTrip",
      "type": "object",
      "description": "Represents an organized group trip to explore Moroccan cities.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the trip."
        },
        "name": {
          "type": "string",
          "description": "Name of the trip package."
        },
        "label": {
          "type": "string",
          "description": "An internal label for the service, used for easier identification in the admin dashboard. Not visible to customers."
        },
        "description": {
          "type": "string",
          "description": "Detailed itinerary and description of the trip."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of a feature image for the trip.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Total price per person for the trip."
        },
        "duration": {
          "type": "string",
          "description": "Duration of the trip, e.g., '7 Days / 6 Nights'."
        },
        "destinations": {
          "type": "string",
          "description": "Comma-separated list of cities visited."
        },
        "groupSize": {
          "type": "string",
          "description": "Maximum group size, e.g., 'Up to 12 people'."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the trip is currently available for booking."
        },
        "isBestOffer": {
          "type": "boolean",
          "description": "Indicates if the service should be featured on the homepage."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "duration",
        "destinations"
      ]
    },
    "Reservation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reservation",
      "type": "object",
      "description": "Represents a reservation made by a user via online checkout.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reservation."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Reservation)"
        },
        "customerName": {
          "type": "string",
          "description": "Full name of the customer making the reservation."
        },
        "serviceType": {
          "type": "string",
          "description": "Type of service reserved (e.g., 'CarRental', 'Hotel', 'Transport', 'Explore')."
        },
        "serviceId": {
          "type": "string",
          "description": "ID of the specific service being reserved (e.g., CarRental.id)."
        },
        "serviceName": {
          "type": "string",
          "description": "Name of the service being reserved."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the reservation.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the reservation.",
          "format": "date-time"
        },
        "origin": {
          "type": "string",
          "description": "Origin location for transport services."
        },
        "destination": {
          "type": "string",
          "description": "Destination location for transport services."
        },
        "price": {
          "type": "number",
          "description": "Base price of the service per unit."
        },
        "priceUnit": {
          "type": "string",
          "enum": [
            "day",
            "night",
            "trip"
          ],
          "description": "The unit for the price (day, night, or trip)."
        },
        "totalPrice": {
          "type": "number",
          "description": "Total price of the reservation."
        },
        "status": {
          "type": "string",
          "enum": ["active", "completed", "cancelled"],
          "description": "The status of the reservation."
        },
        "paymentStatus": {
          "type": "string",
          "enum": [
            "pending",
            "completed"
          ],
          "description": "The payment status of the reservation."
        },
        "createdAt": {
          "type": "string",
          "description": "Date when the reservation was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "customerName",
        "serviceType",
        "serviceId",
        "serviceName",
        "price",
        "priceUnit",
        "totalPrice",
        "paymentStatus",
        "createdAt"
      ]
    },
    "Inquiry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inquiry",
      "type": "object",
      "description": "Represents a manual booking inquiry made via email or WhatsApp.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the inquiry."
        },
        "customerName": {
          "type": "string",
          "description": "Full name of the customer making the inquiry."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "message": {
          "type": "string",
          "description": "The customer's message."
        },
        "serviceId": {
          "type": "string",
          "description": "ID of the specific service being inquired about."
        },
        "serviceName": {
          "type": "string",
          "description": "Name of the service being inquired about."
        },
        "bookingMethod": {
          "type": "string",
          "enum": ["email", "whatsapp"],
          "description": "The method used for the inquiry."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the potential reservation.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the potential reservation.",
          "format": "date-time"
        },
        "origin": {
          "type": "string",
          "description": "Origin location for transport inquiries."
        },
        "destination": {
          "type": "string",
          "description": "Destination location for transport inquiries."
        },
        "totalPrice": {
          "type": "number",
          "description": "Estimated total price of the inquiry."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "completed", "cancelled"],
          "description": "The status of the inquiry."
        },
        "paymentStatus": {
          "type": "string",
          "enum": ["unpaid", "paid"],
          "description": "The payment status of the inquiry."
        },
        "createdAt": {
          "type": "string",
          "description": "Date when the inquiry was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "customerName",
        "serviceId",
        "serviceName",
        "bookingMethod",
        "createdAt"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "AdminUser": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminUser",
      "type": "object",
      "description": "Represents an administrator user for the dashboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin user, corresponds to Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "description": "Email address of the admin user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the admin user.",
          "enum": ["admin", "superadmin"]
        },
        "createdAt": {
          "type": "string",
          "description": "The date the admin was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "createdAt"
      ]
    },
    "ServiceSuggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceSuggestion",
      "type": "object",
      "description": "Represents a service suggestion generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service suggestion."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ServiceSuggestion).  The user that this suggestion is for."
        },
        "serviceType": {
          "type": "string",
          "description": "The type of service being suggested (e.g., 'Hotel', 'Transport', 'CarRental')."
        },
        "serviceId": {
          "type": "string",
          "description": "Reference to the specific service being suggested.  For example, the ID of a hotel in the Hotel entity."
        },
        "suggestionReason": {
          "type": "string",
          "description": "Reason for the suggestion (e.g., 'Past booking history', 'Similar preferences')."
        },
        "suggestionDate": {
          "type": "string",
          "description": "Date when the suggestion was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "serviceType",
        "serviceId",
        "suggestionReason",
        "suggestionDate"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a user review for a service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "userId": {
          "type": "string",
          "description": "ID of the user who wrote the review."
        },
        "serviceId": {
          "type": "string",
          "description": "ID of the service being reviewed."
        },
        "rating": {
          "type": "number",
          "description": "Rating from 1 to 5."
        },
        "comment": {
          "type": "string",
          "description": "The user's review comment."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Date when the review was created."
        },
        "authorName": {
          "type": "string",
          "description": "Display name of the author."
        },
        "authorImage": {
          "type": "string",
          "description": "Profile image URL of the author.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "serviceId",
        "rating",
        "comment",
        "createdAt",
        "authorName"
      ]
    },
    "AppSettings": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AppSettings",
      "type": "object",
      "description": "Stores application-wide settings.",
      "properties": {
        "logoUrl": { "type": "string", "format": "uri" },
        "whatsappNumber": { "type": "string" },
        "bookingEmailTo": { "type": "string", "format": "email" },
        "resendEmailFrom": { "type": "string" },
        "heroBackgroundImageUrl": { "type": "string", "format": "uri" },
        "suggestionsBackgroundImageUrl": { "type": "string", "format": "uri" },
        "categories": {
          "type": "object",
          "properties": {
            "cars": { "type": "boolean" },
            "hotels": { "type": "boolean" },
            "transport": { "type": "boolean" },
            "explore": { "type": "boolean" }
          }
        },
        "categoryImages": {
          "type": "object",
          "properties": {
            "cars": { "type": "string", "format": "uri" },
            "hotels": { "type": "string", "format": "uri" },
            "transport": { "type": "string", "format": "uri" },
            "explore": { "type": "string", "format": "uri" }
          }
        }
      }
    },
    "EmailTemplate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmailTemplate",
      "type": "object",
      "description": "Stores an HTML email template.",
      "properties": {
        "template": { "type": "string" }
      },
      "required": ["template"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. Path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reservations/{reservationId}",
        "definition": {
          "entityName": "Reservation",
          "schema": {
            "$ref": "#/backend/entities/Reservation"
          },
          "description": "Stores reservations made by a specific user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "reservationId",
              "description": "The unique identifier for the reservation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/serviceSuggestions/{serviceSuggestionId}",
        "definition": {
          "entityName": "ServiceSuggestion",
          "schema": {
            "$ref": "#/backend/entities/ServiceSuggestion"
          },
          "description": "Stores service suggestions for a specific user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "serviceSuggestionId",
              "description": "The unique identifier for the service suggestion."
            }
          ]
        }
      },
      {
        "path": "/hotels/{hotelId}",
        "definition": {
          "entityName": "Hotel",
          "schema": {
            "$ref": "#/backend/entities/Hotel"
          },
          "description": "Stores hotel data.",
          "params": [
            {
              "name": "hotelId",
              "description": "The unique identifier for the hotel."
            }
          ]
        }
      },
      {
        "path": "/carRentals/{carRentalId}",
        "definition": {
          "entityName": "CarRental",
          "schema": {
            "$ref": "#/backend/entities/CarRental"
          },
          "description": "Stores car rental data.",
          "params": [
            {
              "name": "carRentalId",
              "description": "The unique identifier for the car rental."
            }
          ]
        }
      },
      {
        "path": "/transports/{transportId}",
        "definition": {
          "entityName": "Transport",
          "schema": {
            "$ref": "#/backend/entities/Transport"
          },
          "description": "Stores transport data.",
          "params": [
            {
              "name": "transportId",
              "description": "The unique identifier for the transport service."
            }
          ]
        }
      },
      {
        "path": "/exploreTrips/{tripId}",
        "definition": {
          "entityName": "ExploreTrip",
          "schema": {
            "$ref": "#/backend/entities/ExploreTrip"
          },
          "description": "Stores organized group trip data.",
          "params": [
            {
              "name": "tripId",
              "description": "The unique identifier for the explore trip."
            }
          ]
        }
      },
      {
        "path": "/inquiries/{inquiryId}",
        "definition": {
          "entityName": "Inquiry",
          "schema": {
            "$ref": "#/backend/entities/Inquiry"
          },
          "description": "Stores manual booking inquiries from email and WhatsApp.",
          "params": [
            {
              "name": "inquiryId",
              "description": "The unique identifier for the inquiry."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{adminId}",
        "definition": {
          "entityName": "AdminUser",
          "schema": {
            "$ref": "#/backend/entities/AdminUser"
          },
          "description": "Collection to store admin user roles and data. Used for role-based access control.",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier for the admin user, matching their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores all reviews for all services. Publicly readable.",
          "params": [
            {
              "name": "reviewId",
              "description": "The unique identifier for the review."
            }
          ]
        }
      },
      {
        "path": "/app_settings/{settingsId}",
        "definition": {
          "entityName": "AppSettings",
          "schema": {
            "$ref": "#/backend/entities/AppSettings"
          },
          "description": "Stores global application settings. There should only be one document with a fixed ID like 'general'.",
          "params": [
            {
              "name": "settingsId",
              "description": "The unique identifier for the settings document, e.g., 'general'."
            }
          ]
        }
      },
      {
        "path": "/email_templates/{templateId}",
        "definition": {
          "entityName": "EmailTemplate",
          "schema": {
            "$ref": "#/backend/entities/EmailTemplate"
          },
          "description": "Stores HTML email templates. Use fixed IDs like 'admin_notification' and 'client_confirmation'.",
          "params": [
            {
              "name": "templateId",
              "description": "The unique ID for the template."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, DBAC, and QAPs. User data is stored under `/users/{userId}` ensuring path-based ownership. Reservations made by each user are stored in a subcollection `/users/{userId}/reservations/{reservationId}`. Service Suggestions are similarly organized under `/users/{userId}/serviceSuggestions/{serviceSuggestionId}`, ensuring the suggestions are linked to the correct user.\n\nThe `hotels`, `carRentals`, `transports`, and `exploreTrips` collections store the data for each of those service types. Admin users are managed via the `/roles_admin/{adminId}` collection, which now stores a `role` field for fine-grained access control (admin vs. superadmin). A top-level `reviews` collection is added to store user reviews for all services; this allows for easy querying by service and is secured to allow creation only by authenticated users for themselves.\n\nThis structure achieves Authorization Independence by avoiding hierarchical authorization dependencies. All authorization rules rely on `request.auth.uid` and the document paths. Denormalization is not required in this schema because user-owned data is stored in hierarchical paths. This approach ensures proper QAPs, as listing operations are secure based on path-based ownership.\n\nBy using this schema and appropriate security rules, we can prevent filter-based security and ensure that all listing operations are inherently secure."
  }
}
